# Update the details, status, comments, severity override and override justification as well as locked status of a vulnerability V-xxxxxx identifier within the specified checklist
# API call from Developer's Guide: /api/external/systempackage/{systemKey}/checklist/{checklistId}/vulnid/{vulnerabilityId}/?applicationKey={applicationKey}
# ex: python3 updateChecklistVulnerability.py http://192.168.13.111:8080 companyinfra 627d44fbff17ea6dfdf0d702 V-220703 "NotAFinding" "This is in the GPO push" "Automated push to fix nightly" openrmfprosvc hvs.xxxxxxxxxxxxxx

import sys
import requests
from requests.structures import CaseInsensitiveDict
from html import escape

url = sys.argv[1] + "/api/external/systempackage/" + sys.argv[2] + "/checklist/" + sys.argv[3] + "/vulnid/" + sys.argv[4] + "?applicationKey=" + sys.argv[8]

data = "status=" + escape(sys.argv[5]) + "&details=" + escape(sys.argv[6]) + "&comments=" + escape(sys.argv[7]) 

# Assign the request headers for this particular API
headers = CaseInsensitiveDict() # Does not change
headers["Accept"] = "application/json"
headers["Authorization"] = "Bearer " + sys.argv[9]
headers["Content-Type"] = "application/x-www-form-urlencoded"

# Make the API request
resp = requests.put(url, headers=headers, data=data)

# print to the screen the status code (i.e. 200, 400, 404, etc)
print(resp.status_code)
print(resp.text)